{{ define "main" }}
{{ $renders := sort (default (slice) .Params.renders) "date" "desc" }}
<section class="gallery-hero">
  <div class="gallery-hero-content">
    <p class="gallery-kicker">3D Modeling</p>
    <h1>{{ .Title }}</h1>
    {{ with .Params.description }}
    <p class="gallery-intro">{{ . }}</p>
    {{ end }}
  </div>
</section>

{{ if gt (len $renders) 0 }}
<section class="gallery">
  <div class="gallery-grid">
    {{ range $renders }}
    {{ $render := . }}
    {{ $images := slice }}
    {{ if isset $render "images" }}
      {{ range $render.images }}
        {{ with $.Resources.GetMatch . }}
          {{ $images = $images | append . }}
        {{ end }}
      {{ end }}
    {{ else if isset $render "image" }}
      {{ with $.Resources.GetMatch $render.image }}
        {{ $images = $images | append . }}
      {{ end }}
    {{ end }}
    {{ $cover := index $images 0 }}
    <article class="render-card">
      {{ with $cover }}
      <a class="render-image-link" href="{{ .RelPermalink }}" target="_blank" rel="noopener noreferrer">
        <img src="{{ .RelPermalink }}" alt="{{ $render.title }} render">
      </a>
      {{ end }}
      <div class="render-card-body">
        <div class="render-meta">
          {{ with $render.date }}
          <time datetime="{{ . }}">{{ (time .).Format "02 Jan 2006" }}</time>
          {{ end }}
        </div>
        <h3>{{ $render.title }}</h3>
        {{ with $render.description }}
        <p>{{ . }}</p>
        {{ end }}
        {{ if gt (len $images) 1 }}
        <div class="render-thumbs" aria-label="Additional angles">
          {{ range $index, $img := (after 1 $images) }}
          <a href="{{ $img.RelPermalink }}" target="_blank" rel="noopener noreferrer">
            <img src="{{ $img.RelPermalink }}" alt="{{ printf "%s angle %d" $render.title (add $index 2) }}">
          </a>
          {{ end }}
        </div>
        {{ end }}
      </div>
    </article>
    {{ end }}
  </div>
</section>
{{ else }}
<section class="gallery">
  <p>No renders published yet. Check back soon.</p>
</section>
{{ end }}
{{ end }}
